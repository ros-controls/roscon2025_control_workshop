<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <arg name="mock_hardware" default="true"/>
    <arg name="rviz" default="true"/>

    <let name="robot_description"
         value="$(command 'xacro $(find-pkg-share wbot_description)/urdf/wbot.urdf.xacro
                mock_hardware:=$(var mock_hardware)
         ')" />

    <node pkg="robot_state_publisher" exec="robot_state_publisher" output="both">
        <param name="robot_description" value="$(var robot_description)" />
    </node>

    <!-- ros2_control -->
    <node pkg="controller_manager" exec="ros2_control_node" output="both">
        <remap from="~/robot_description" to="/robot_description" />
        <param from="$(find-pkg-share wbot_bringup)/config/wbot_controllers.yaml" />
        <!-- remap the topics from the diff drive controller to the base topic names -->
        <remap from="/diff_drive_base_controller/cmd_vel" to="/cmd_vel"/>
        <remap from="/diff_drive_base_controller/odom" to="/odom"/>
    </node>

    <!-- ros2_control spawners -->
    <node pkg="controller_manager" exec="spawner"
          args="diff_drive_base_controller joint_state_broadcaster -c /controller_manager" />

    <group if="$(var rviz)">
        <node pkg="rviz2" exec="rviz2" name="robot" args="-d $(find-pkg-share wbot_bringup)/rviz/robotmodel.rviz" output="both"/>
    </group>
</launch>
